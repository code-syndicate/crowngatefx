---
export const prerender = false;

import config from "../../config";
import Layout from "../../layouts/Layout.astro";
import Footer from "../../components/Footer";
import AdminSwitcher from "../../components/AdminSwitcher";
import { checkAdminAuth } from "../../lib/checkauth";

if (!Astro.cookies.has(config.authCookieKey)) {
  return Astro.redirect("/sign-in");
}

const authUser = Astro.cookies.get(config.authCookieKey).value;

const isAuth = await checkAdminAuth({
  email: authUser,
});

if (!isAuth) {
  return Astro.redirect("/dashboard");
}
---

<Layout title={config.appName}>
  <div class="min-h-screen">
    <!-- Mobile App-like Header -->
    <div class="lg:hidden bg-surface/50 backdrop-blur-xl sticky top-0 z-40 px-5 py-4 border-b border-white/5">
      <p class="text-text2 text-xs uppercase tracking-widest font-bold">Admin</p>
      <h1 class="text-xl font-bold text-white tracking-tight">User Management</h1>
    </div>

    <!-- Desktop Header -->
    <div class="hidden lg:block px-8 pt-4 max-w-7xl mx-auto">
      <h1 class="text-3xl font-bold text-white tracking-tight">Admin Dashboard</h1>
      <p class="text-text2 mt-1">Manage users and system settings.</p>
    </div>

    <!-- Main Content -->
    <div class="px-4 lg:px-8 py-6 max-w-7xl mx-auto">
      <AdminSwitcher user={isAuth.user} client:load />
    </div>

    <Footer />
  </div>
</Layout>
