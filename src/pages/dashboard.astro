---
export const prerender = false;

import config from "../config";
import Layout from "../layouts/Layout.astro";
import Footer from "../components/Footer";
import Dash from "../components/Dash";
import { checkAuth } from "../lib/checkauth";

if (!Astro.cookies.has(config.authCookieKey)) {
  return Astro.redirect("/sign-in");
}

const authUser = Astro.cookies.get(config.authCookieKey).value;

const isAuth = await checkAuth({
  email: authUser,
});

if (!isAuth) {
  return Astro.redirect("/sign-in");
}
---

<Layout title={config.appName}>
  <Dash client:load auth={isAuth} />

  <!-- Coin Price Ticker -->
  <div class="px-4 lg:px-8 max-w-7xl mx-auto">
    <script src="https://widgets.coingecko.com/coingecko-coin-price-marquee-widget.js"></script>
    <coingecko-coin-price-marquee-widget
      coin-ids="bitcoin,ethereum,eos,ripple,litecoin"
      currency="usd"
      background-color="#131720"
      locale="en"
      font-color="#ffffff">
    </coingecko-coin-price-marquee-widget>
  </div>

  <!-- Trading View Chart -->
  <div class="px-4 lg:px-8 py-6 max-w-7xl mx-auto">
    <div class="card-nebula p-4 overflow-hidden">
      <div class="tradingview-widget-container">
        <div id="tradingview_dd969"></div>
        <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
        <script type="text/javascript">
          new TradingView.widget({
            autosize: false,
            symbol: "BITSTAMP:BTCUSD",
            interval: "D",
            timezone: "Etc/UTC",
            width: "100%",
            height: "400",
            theme: "dark",
            style: "3",
            locale: "en",
            enable_publishing: false,
            backgroundColor: "rgba(0, 0, 0, 0)",
            allow_symbol_change: true,
            container_id: "tradingview_dd969",
          });
        </script>
      </div>
    </div>
  </div>

  <Footer />
</Layout>
