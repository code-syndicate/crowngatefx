---
export const prerender = false;

import config from "../config";
import Layout from "../layouts/Layout.astro";
import Footer from "../components/Footer";
import { checkAuth } from "../lib/checkauth";
import SettingsAction from "../components/SettingsActions";
import Profile from "../components/Profile";

if (!Astro.cookies.has(config.authCookieKey)) {
  return Astro.redirect("/sign-in");
}

const authUser = Astro.cookies.get(config.authCookieKey).value;

const isAuth = await checkAuth({
  email: authUser,
});

if (!isAuth) {
  return Astro.redirect("/sign-in");
}

const user = isAuth.user;
---

<Layout title={config.appName}>
  <div class="min-h-screen">
    <!-- Mobile App-like Header -->
    <div class="lg:hidden bg-surface/50 backdrop-blur-xl sticky top-0 z-40 px-5 py-4 border-b border-white/5">
      <p class="text-text2 text-xs uppercase tracking-widest font-bold">Account</p>
      <h1 class="text-xl font-bold text-white tracking-tight">Settings</h1>
    </div>

    <!-- Desktop Header -->
    <div class="hidden lg:block px-8 pt-4 max-w-7xl mx-auto">
      <h1 class="text-3xl font-bold text-white tracking-tight">Account Settings</h1>
      <p class="text-text2 mt-1">Manage your profile and preferences.</p>
    </div>

    <!-- Main Content -->
    <div class="px-4 lg:px-8 py-6 max-w-7xl mx-auto">
      <div class="grid grid-cols-1 lg:grid-cols-6 gap-6">
        <!-- Profile Card - Hidden on mobile, shown in tabs -->
        <div class="hidden lg:block lg:col-span-2">
          <Profile user={user} />
        </div>

        <!-- Settings Actions -->
        <div class="lg:col-span-4">
          <SettingsAction client:visible user={user} />
        </div>
      </div>
    </div>

    <Footer />
  </div>
</Layout>
